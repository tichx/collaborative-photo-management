{"ast":null,"code":"import _slicedToArray from \"/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/src/MainPage.js\";\nimport React, { useEffect, useState } from 'react';\nimport './Styles/MainPage.css';\nimport Alert from 'react-bootstrap/Alert';\n\nvar MainPage = function MainPage(props) {\n  //variable to tell if there's a warning message to show\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      show = _useState2[0],\n      setShow = _useState2[1]; //data structure for getting images\n\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      imgDataList = _useState4[0],\n      setImgDataList = _useState4[1]; //data structure for getting tags\n\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      tagDataList = _useState6[0],\n      setTagDataList = _useState6[1]; //map to store binding between tag id and object\n\n\n  var _useState7 = useState({}),\n      _useState8 = _slicedToArray(_useState7, 2),\n      tagIDTable = _useState8[0],\n      setTagIDTable = _useState8[1];\n\n  var _useState9 = useState({}),\n      _useState10 = _slicedToArray(_useState9, 2),\n      IDTagTable = _useState10[0],\n      setIDTagTable = _useState10[1]; //variable to store selected tag\n\n\n  var _useState11 = useState(-1),\n      _useState12 = _slicedToArray(_useState11, 2),\n      tag = _useState12[0],\n      setTag = _useState12[1];\n\n  var handleTagClick = function handleTagClick(newTagId) {\n    setTag(newTagId);\n  };\n\n  var handleShow = function handleShow(show) {\n    setShow(show);\n  };\n\n  var _useState13 = useState(false),\n      _useState14 = _slicedToArray(_useState13, 2),\n      notifyTagChange = _useState14[0],\n      setNotifyTagChange = _useState14[1];\n\n  var NotifyTagUpdate = function NotifyTagUpdate() {\n    setNotifyTagChange(!notifyTagChange);\n  }; // TEST ONLY!!!backdoor code for getting authorization token.\n  // console.log(localStorage.getItem(\"Authorization\"));\n  // Fetch all img data\n\n\n  useEffect(function () {\n    fetch(\"https://api.xutiancheng.me/v1/photos\", {\n      method: 'get',\n      headers: new Headers({\n        'Authorization': localStorage.getItem(\"Authorization\")\n      })\n    }).then(function (resp) {\n      return resp.json();\n    }).then(function (data) {\n      setImgDataList(data);\n    });\n  }, []); // Fetch all tag data\n\n  useEffect(function () {\n    fetch(\"https://api.xutiancheng.me/v1/tags\", {\n      method: 'get',\n      headers: new Headers({\n        'Authorization': localStorage.getItem(\"Authorization\")\n      })\n    }).then(function (resp) {\n      return resp.json();\n    }).then(function (data) {\n      for (var index = 0; index < data.length; index++) {\n        var element = data[index];\n        var obj = {};\n        obj[element.id] = element.name;\n        Object.assign(tagIDTable, obj);\n        var obj2 = {};\n        obj2[element.name] = element.id;\n        Object.assign(IDTagTable, obj2);\n      }\n\n      setTagDataList(data);\n    });\n  }, [notifyTagChange]);\n\n  if (show) {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76\n      },\n      __self: this\n    }, React.createElement(TagTextField, {\n      NotifyTagUpdate: NotifyTagUpdate,\n      handleShow: handleShow,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77\n      },\n      __self: this\n    }), React.createElement(TagButtonList, {\n      tags: tagDataList,\n      setTag: handleTagClick,\n      NotifyTagUpdate: NotifyTagUpdate,\n      handleShow: handleShow,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78\n      },\n      __self: this\n    }), React.createElement(ImgCardList, {\n      tag: tag,\n      imgDataList: imgDataList,\n      tagIDTable: tagIDTable,\n      IDTagTable: IDTagTable,\n      NotifyTagUpdate: NotifyTagUpdate,\n      handleShow: handleShow,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79\n      },\n      __self: this\n    }), React.createElement(Alert, {\n      variant: \"danger\",\n      onClose: function onClose() {\n        return setShow(false);\n      },\n      dismissible: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82\n      },\n      __self: this\n    }, React.createElement(Alert.Heading, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83\n      },\n      __self: this\n    }, \"error for this request\"), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84\n      },\n      __self: this\n    }, \"make sure you have a valid auth session, the image upload isn't duplicate, also the tag is case sensitive. If it's not your problem then maybe there's an internal error.\")));\n  } else {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95\n      },\n      __self: this\n    }, React.createElement(TagTextField, {\n      NotifyTagUpdate: NotifyTagUpdate,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96\n      },\n      __self: this\n    }), React.createElement(TagButtonList, {\n      tags: tagDataList,\n      setTag: handleTagClick,\n      NotifyTagUpdate: props.NotifyTagUpdate,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97\n      },\n      __self: this\n    }), React.createElement(ImgCardList, {\n      tag: tag,\n      imgDataList: imgDataList,\n      tagIDTable: tagIDTable,\n      IDTagTable: IDTagTable,\n      NotifyTagUpdate: NotifyTagUpdate,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    }));\n  }\n}; //populates the tag buttons into a list\n\n\nvar TagButtonList = function TagButtonList(props) {\n  var TagLists = props.tags.map(function (data) {\n    return React.createElement(TagButton, {\n      key: data.id,\n      tag: data,\n      setTag: props.setTag,\n      NotifyTagUpdate: props.NotifyTagUpdate,\n      handleShow: handleShow,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    });\n  });\n  return React.createElement(\"div\", {\n    style: {\n      display: \"flex\",\n      \"flexDirection\": \"row\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }, TagLists);\n}; //gets the new tag name typed by user, after user press 'Enter', pass it to /v1/tags\n//with payload: {\"name\": \"tagname\"}\n\n\nvar TagTextField = function TagTextField(props) {\n  return React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"create new tag\",\n    onKeyPress: function onKeyPress(event) {\n      if (event.key === 'Enter') {\n        var newTag = event.target.value; // POST request using fetch inside useEffect React hook\n\n        var requestOptions = {\n          method: 'post',\n          headers: new Headers({\n            'Content-Type': 'application/json',\n            'Authorization': localStorage.getItem(\"Authorization\")\n          }),\n          body: JSON.stringify({\n            \"name\": newTag\n          })\n        };\n        fetch(\"https://api.xutiancheng.me/v1/tags\", requestOptions).then(function (resp) {\n          return resp.json();\n        }).then(function (resp) {\n          if (resp.status == 201) {\n            setTimeout(function () {\n              props.NotifyTagUpdate();\n            }, 1000);\n          } else {\n            props.handleShow(true);\n          }\n        });\n      }\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  });\n}; //individual button showing each tag\n\n\nvar TagButton = function TagButton(props) {\n  var handleTagClick = function handleTagClick(e) {\n    props.setTag(props.tag.id);\n  };\n\n  return React.createElement(\"div\", {\n    style: {\n      display: \"flex\",\n      flexWrap: \"wrap\",\n      flexDirection: \"row\",\n      margin: \"15px\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    onClick: handleTagClick,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, props.tag.name), React.createElement(BindTagMember, {\n    tagID: props.tag.id,\n    NotifyTagUpdate: props.NotifyTagUpdate,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }));\n}; //populates the image cards into a list\n\n\nvar ImgCardList = function ImgCardList(props) {\n  var photoListItems;\n\n  if (props.tag === -1) {\n    photoListItems = props.imgDataList.map(function (data) {\n      return React.createElement(ImgCard, {\n        key: data.id,\n        img: data,\n        style: {\n          display: \"flex\",\n          \"flex-wrap\": \"wrap\",\n          \"flexDirection\": \"row\"\n        },\n        tagIDTable: props.tagIDTable,\n        IDTagTable: props.IDTagTable,\n        NotifyTagUpdate: props.NotifyTagUpdate,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      });\n    });\n  } else {\n    photoListItems = props.imgDataList.map(function (data) {\n      var tagIds = [];\n      data.tags.forEach(function (e) {\n        tagIds.push(e.id);\n      });\n\n      if (tagIds.includes(props.tag)) {\n        // return <ImgCard key={data.id} img={data} tags={props.tags}/>\n        return React.createElement(ImgCard, {\n          key: data.id,\n          img: data,\n          style: {\n            display: \"flex\",\n            \"flex-wrap\": \"wrap\",\n            \"flexDirection\": \"row\"\n          },\n          tagIDTable: props.tagIDTable,\n          IDTagTable: props.IDTagTable,\n          NotifyTagUpdate: props.NotifyTagUpdate,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 183\n          },\n          __self: this\n        });\n      }\n    });\n  }\n\n  return photoListItems;\n}; //individual image card, still missing function that when clicked,\n//lets user add a tag for this photo\n\n\nvar ImgCard = function ImgCard(props) {\n  var tagNameList = [];\n\n  for (var index = 0; index < props.img.tags.length; index++) {\n    var tagIDFromImage = props.img.tags[index].id;\n    var tagID = props.tagIDTable[tagIDFromImage];\n    tagNameList.push(tagID);\n  }\n\n  var displayResult = tagNameList.map(function (item, i) {\n    return React.createElement(\"p\", {\n      key: i,\n      className: \"font-size-0-8\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }, item);\n  });\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: props.img.url,\n    alt: \"wrong image url\",\n    style: {\n      width: \"150px\",\n      height: \"150px\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209\n    },\n    __self: this\n  }), displayResult, React.createElement(BindTagImg, {\n    imgID: props.img.id,\n    IDTagTable: props.IDTagTable,\n    NotifyTagUpdate: props.NotifyTagUpdate,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211\n    },\n    __self: this\n  }));\n}; //bind image to a new tag name input by user and post \n//it to /v1/photos/:photoID/tag/:tagID \n\n\nvar BindTagImg = function BindTagImg(props) {\n  var imageID = props.imgID;\n  return React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"bind photo with old tag\",\n    onKeyPress: function onKeyPress(event) {\n      if (event.key === 'Enter') {\n        var tagName = event.target.value;\n        var tagID = props.IDTagTable[tagName]; // POST request using fetch inside useEffect React hook\n\n        var requestOptions = {\n          method: 'post',\n          headers: new Headers({\n            'Authorization': localStorage.getItem(\"Authorization\")\n          })\n        };\n        fetch(\"https://api.xutiancheng.me/v1/photos/\" + imageID + \"/tag/\" + tagID, requestOptions).then(function (resp) {\n          if (resp.status < 300) {\n            setTimeout(function () {\n              props.NotifyTagUpdate();\n            }, 1000);\n          } else {\n            props.setShow(true);\n          }\n        });\n      }\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222\n    },\n    __self: this\n  });\n}; //bind tag to a user id input by user and post \n//it\n\n\nvar BindTagMember = function BindTagMember(props) {\n  var tagID = props.tagID;\n  return React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"userID\",\n    style: {\n      width: \"50px\"\n    },\n    onKeyPress: function onKeyPress(event) {\n      if (event.key === 'Enter') {\n        var userID = event.target.value; // POST request using fetch inside useEffect React hook\n\n        var requestOptions = {\n          method: 'post',\n          headers: new Headers({\n            'Content-Type': 'application/json',\n            'Authorization': localStorage.getItem(\"Authorization\")\n          }),\n          body: JSON.stringify({\n            \"id\": userID\n          })\n        };\n        fetch(\"https://api.xutiancheng.me/v1/tags/\" + tagID + \"/members\", requestOptions).then(function (resp) {\n          if (resp.status < 300) {\n            setTimeout(function () {\n              props.NotifyTagUpdate();\n            }, 1000);\n          } else {\n            props.setShow(true);\n          }\n        });\n      }\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256\n    },\n    __self: this\n  });\n};\n\nexport default MainPage;","map":{"version":3,"sources":["/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/src/MainPage.js"],"names":["React","useEffect","useState","Alert","MainPage","props","show","setShow","imgDataList","setImgDataList","tagDataList","setTagDataList","tagIDTable","setTagIDTable","IDTagTable","setIDTagTable","tag","setTag","handleTagClick","newTagId","handleShow","notifyTagChange","setNotifyTagChange","NotifyTagUpdate","fetch","method","headers","Headers","localStorage","getItem","then","resp","json","data","index","length","element","obj","id","name","Object","assign","obj2","TagButtonList","TagLists","tags","map","display","TagTextField","event","key","newTag","target","value","requestOptions","body","JSON","stringify","status","setTimeout","TagButton","e","flexWrap","flexDirection","margin","ImgCardList","photoListItems","tagIds","forEach","push","includes","ImgCard","tagNameList","img","tagIDFromImage","tagID","displayResult","item","i","url","width","height","BindTagImg","imageID","imgID","tagName","BindTagMember","userID"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport './Styles/MainPage.css';\nimport Alert from 'react-bootstrap/Alert';\n\nconst MainPage = (props) => {\n    //variable to tell if there's a warning message to show\n    const [show, setShow] = useState(false);\n    //data structure for getting images\n    const [imgDataList,setImgDataList] = useState([]);\n    //data structure for getting tags\n    const [tagDataList,setTagDataList] = useState([]);\n    //map to store binding between tag id and object\n    const [tagIDTable, setTagIDTable] = useState({});\n    const [IDTagTable, setIDTagTable] = useState({});\n    //variable to store selected tag\n    const [tag,setTag] = useState(-1);\n    const handleTagClick = (newTagId)=>{\n        setTag(newTagId);\n    }\n    const handleShow = (show) => {\n        setShow(show);\n    }\n\n    const [notifyTagChange, setNotifyTagChange] = useState(false);\n\n    const NotifyTagUpdate = () =>{\n        \n        setNotifyTagChange(!notifyTagChange);\n        \n    }\n\n    // TEST ONLY!!!backdoor code for getting authorization token.\n    // console.log(localStorage.getItem(\"Authorization\"));\n\n\n    // Fetch all img data\n    useEffect(() => {\n        fetch(\"https://api.xutiancheng.me/v1/photos\",  { \n            method: 'get', \n            headers: new Headers({\n                'Authorization': localStorage.getItem(\"Authorization\"), \n            })\n          })\n        .then(resp => resp.json())\n        .then(data => {setImgDataList(data)})\n    },[]);\n    // Fetch all tag data\n    useEffect(() => {\n        fetch(\"https://api.xutiancheng.me/v1/tags\",  { \n            method: 'get', \n            headers: new Headers({\n                  'Authorization': localStorage.getItem(\"Authorization\"), \n            })\n          })\n        .then(resp => resp.json())\n        .then(data => \n        {   \n            for (let index = 0; index < data.length; index++) {\n                const element = data[index];\n                let obj={};\n                obj[element.id] = element.name;\n                Object.assign(tagIDTable, obj);\n    \n                let obj2={};\n                obj2[element.name] = element.id;\n                Object.assign(IDTagTable, obj2);\n            }\n            setTagDataList(data);\n        })\n\n\n    },[notifyTagChange]);\n\n    if (show) {\n        return (\n            <div>\n            <TagTextField NotifyTagUpdate={NotifyTagUpdate} handleShow={handleShow}/>\n            <TagButtonList tags={tagDataList} setTag={handleTagClick} NotifyTagUpdate={NotifyTagUpdate} handleShow={handleShow}/>\n            <ImgCardList tag={tag} imgDataList={imgDataList} tagIDTable={tagIDTable} IDTagTable={IDTagTable} NotifyTagUpdate={NotifyTagUpdate} handleShow={handleShow}/>\n            {/* <button onClick={BindTagImg} key=\"12345\" IDTagTable={IDTagTable}>Add Tag</button> */}\n            {/* <ImgCardList tags={tagDataList} tag={tag} imgDataList={imgDataList}/> */}\n            <Alert variant=\"danger\" onClose={() => setShow(false)} dismissible>\n            <Alert.Heading>error for this request</Alert.Heading>\n            <p>\n              make sure you have a valid auth session, the image upload isn't \n              duplicate, also the tag is case sensitive. If it's not your problem\n              then maybe there's an internal error.\n            </p>\n          </Alert>\n        </div>\n\n        );\n    } else {\n        return (\n            <div>\n                <TagTextField NotifyTagUpdate={NotifyTagUpdate}/>\n                <TagButtonList tags={tagDataList} setTag={handleTagClick} NotifyTagUpdate={props.NotifyTagUpdate}/>\n                <ImgCardList tag={tag} imgDataList={imgDataList} tagIDTable={tagIDTable} IDTagTable={IDTagTable} NotifyTagUpdate={NotifyTagUpdate}/>\n                {/* <button onClick={BindTagImg} key=\"12345\" IDTagTable={IDTagTable}>Add Tag</button> */}\n                {/* <ImgCardList tags={tagDataList} tag={tag} imgDataList={imgDataList}/> */}\n            </div>\n            );\n    }\n\n    \n}\n\n//populates the tag buttons into a list\nconst TagButtonList = (props)=>{\n    const TagLists = props.tags.map(data=><TagButton key={data.id} tag={data} setTag={props.setTag} NotifyTagUpdate={props.NotifyTagUpdate} handleShow={handleShow}/>);\n    \n    return (<div style={{display:\"flex\",\"flexDirection\": \"row\"}}>{TagLists}</div>)\n}\n\n//gets the new tag name typed by user, after user press 'Enter', pass it to /v1/tags\n//with payload: {\"name\": \"tagname\"}\nconst TagTextField = (props) => {\n    return <input\n    type=\"text\"\n    placeholder=\"create new tag\"\n    onKeyPress={event => {\n                if (event.key === 'Enter') {\n                    var newTag = event.target.value;\n                        // POST request using fetch inside useEffect React hook\n                        const requestOptions = {\n                            method: 'post',\n                            headers: new Headers({\n                                'Content-Type': 'application/json',\n                                'Authorization': localStorage.getItem(\"Authorization\"), \n                              }),\n                            body: JSON.stringify({\"name\": newTag})\n                        };\n\n                        fetch(\"https://api.xutiancheng.me/v1/tags\", requestOptions)\n                        .then(resp => resp.json())\n                        .then(resp =>{\n                            if (resp.status == 201){\n                                setTimeout(() => {\n                                    props.NotifyTagUpdate();\n                                }, 1000)\n                            } else{\n                                props.handleShow(true);\n                            }\n                        });\n                        \n\n                }\n              }}\n    />;\n\n};\n\n//individual button showing each tag\nconst TagButton = (props)=>{\n\n    const handleTagClick = (e)=>{\n        props.setTag(props.tag.id)\n    }\n        return <div style={{display:\"flex\",flexWrap:\"wrap\",flexDirection: \"row\", margin:\"15px\"}}>\n            <button onClick={handleTagClick}>{props.tag.name}</button>\n            <BindTagMember tagID = {props.tag.id} NotifyTagUpdate={props.NotifyTagUpdate}/>\n        </div>\n}\n\n//populates the image cards into a list\nconst ImgCardList = (props) => {\n    var photoListItems;\n    if (props.tag === -1) {\n        photoListItems = props.imgDataList.map((data) => {\n\n            return <ImgCard key={data.id} img={data} style={{display:\"flex\",\"flex-wrap\":\"wrap\",\"flexDirection\": \"row\"}}  tagIDTable={props.tagIDTable} IDTagTable={props.IDTagTable} NotifyTagUpdate={props.NotifyTagUpdate}/>\n        });\n    } else {\n\n        photoListItems = props.imgDataList.map((data) => {\n            var tagIds = []\n            data.tags.forEach(e => {\n                tagIds.push(e.id)\n            });\n            if (tagIds.includes(props.tag)){\n                // return <ImgCard key={data.id} img={data} tags={props.tags}/>\n\n                return <ImgCard key={data.id} img={data} style={{display:\"flex\",\"flex-wrap\":\"wrap\",\"flexDirection\": \"row\"}} tagIDTable={props.tagIDTable} IDTagTable={props.IDTagTable} NotifyTagUpdate={props.NotifyTagUpdate}/>\n            }\n        });\n    }\n    \n    return (photoListItems)\n}\n\n//individual image card, still missing function that when clicked,\n//lets user add a tag for this photo\nconst ImgCard = (props) =>{\n    \n    let tagNameList = [];\n    for (let index = 0; index < props.img.tags.length; index++) {\n        let tagIDFromImage = props.img.tags[index].id;\n        let tagID = props.tagIDTable[tagIDFromImage];\n        tagNameList.push(tagID);\n    }\n    let displayResult = tagNameList.map((item, i) => (\n          <p key={i} className=\"font-size-0-8\">\n            {item}\n          </p>)\n    );\n    \n    return(\n    <div>\n        <img src={props.img.url} alt=\"wrong image url\" style={{width:\"150px\",height:\"150px\"}}/>\n        {displayResult}\n        <BindTagImg imgID={props.img.id} IDTagTable={props.IDTagTable} NotifyTagUpdate={props.NotifyTagUpdate}/>\n         {/* <button onClick={BindTagImg} key={props.img.id} IDTagTable={props.IDTagTable}>Add Tag</button> */}\n    </div>\n     );\n    \n}\n\n//bind image to a new tag name input by user and post \n//it to /v1/photos/:photoID/tag/:tagID \nconst BindTagImg = (props)=>{\n    var imageID = props.imgID;\n    return <input\n    type=\"text\"\n    placeholder=\"bind photo with old tag\"\n    onKeyPress={event => {\n                if (event.key === 'Enter') {\n                    var tagName = event.target.value;\n                    var tagID = props.IDTagTable[tagName];\n                    \n                        // POST request using fetch inside useEffect React hook\n                        const requestOptions = {\n                            method: 'post',\n                            headers: new Headers({\n                                'Authorization': localStorage.getItem(\"Authorization\"), \n                              }),\n                        };\n                        fetch(\"https://api.xutiancheng.me/v1/photos/\"+imageID+\"/tag/\"+tagID, requestOptions)\n                        .then(resp =>{\n                            if (resp.status < 300){\n                                setTimeout(() => {\n                                    props.NotifyTagUpdate();\n                                }, 1000)\n                            } else{\n                                props.setShow(true);\n                            }\n                        });\n                }\n              }}\n    />;\n}\n\n//bind tag to a user id input by user and post \n//it\nconst BindTagMember = (props)=>{\n    var tagID = props.tagID;\n    return <input\n    type=\"text\"\n    placeholder=\"userID\"\n    style={{width:\"50px\"}}\n    onKeyPress={event => {\n                if (event.key === 'Enter') {\n                    var userID = event.target.value;\n                    \n                        // POST request using fetch inside useEffect React hook\n                        const requestOptions = {\n                            method: 'post',\n                            headers: new Headers({\n                                'Content-Type': 'application/json',\n                                'Authorization': localStorage.getItem(\"Authorization\"), \n                              }),\n                            body: JSON.stringify({\"id\": userID})\n                        };\n                        fetch(\"https://api.xutiancheng.me/v1/tags/\"+tagID+\"/members\", requestOptions)\n                        .then(resp =>{\n                            if (resp.status < 300){\n                                setTimeout(() => {\n                                    props.NotifyTagUpdate();\n                                }, 1000)\n                            } else{\n                                props.setShow(true);\n                            }\n                        });\n\n                }\n              }}\n    />;\n}\n\n\nexport default MainPage;"]},"metadata":{},"sourceType":"module"}