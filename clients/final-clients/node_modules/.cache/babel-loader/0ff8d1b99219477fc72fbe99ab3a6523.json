{"ast":null,"code":"import _regeneratorRuntime from \"/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/src/Components/Main/Components/UploadImage/UploadImage.js\";\nimport React, { Component } from 'react';\nimport api from '../../../../Constants/APIEndpoints/APIEndpoints';\nimport Errors from '../../../Errors/Errors';\nimport Alert from 'react-bootstrap/Alert';\n\nvar UploadImage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(UploadImage, _Component);\n\n  function UploadImage(props) {\n    var _this;\n\n    _classCallCheck(this, UploadImage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(UploadImage).call(this, props));\n\n    _this.sendRequest =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(e) {\n        var file, fileName, data, response, error;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                e.preventDefault();\n                file = _this.state.file;\n                fileName = file.name;\n                data = new FormData();\n                data.append('file', file);\n                _context.next = 7;\n                return fetch(api.base + api.handlers.upload, {\n                  method: \"POST\",\n                  body: data,\n                  headers: new Headers({\n                    // 'Content-Type': 'application/json',\n                    \"Authorization\": localStorage.getItem(\"Authorization\")\n                  })\n                });\n\n              case 7:\n                response = _context.sent;\n\n                if (!(response.status >= 300)) {\n                  _context.next = 16;\n                  break;\n                }\n\n                _context.next = 11;\n                return response.text();\n\n              case 11:\n                error = _context.sent;\n\n                _this.setError(error);\n\n                return _context.abrupt(\"return\");\n\n              case 16:\n                if (response.status === 200) {\n                  fetch(\"https://api.xutiancheng.me/v1/photos\", {\n                    method: \"POST\",\n                    body: JSON.stringify({\n                      \"url\": \"https://image-441.s3.amazonaws.com/\" + fileName\n                    }),\n                    headers: new Headers({\n                      'Content-Type': 'application/json',\n                      \"Authorization\": localStorage.getItem(\"Authorization\")\n                    })\n                  }).then(function (resp) {\n                    if (resp.status == 201) {\n                      _this.setShow(true);\n                    } else {\n                      var _error = response.text();\n\n                      _this.setError(_error);\n\n                      return;\n                    }\n                  });\n                }\n\n              case 17:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.handleFile = function (e) {\n      _this.setState({\n        file: e.target.files[0]\n      });\n    };\n\n    _this.setError = function (error) {\n      _this.setState({\n        error: error\n      });\n    };\n\n    _this.setShow = function (boo) {\n      _this.setState({\n        show: show\n      });\n    };\n\n    _this.state = {\n      file: null,\n      error: '',\n      show: false\n    };\n    return _this;\n  }\n\n  _createClass(UploadImage, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          firstName = _this$state.firstName,\n          lastName = _this$state.lastName,\n          error = _this$state.error;\n\n      if (show) {\n        return React.createElement(React.Fragment, null, React.createElement(Errors, {\n          error: error,\n          setError: this.setError,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 74\n          },\n          __self: this\n        }), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 75\n          },\n          __self: this\n        }, \"Upload a new image\"), React.createElement(\"form\", {\n          target: \"_blank\",\n          encType: \"multipart/form-data\" // action=\"https://api.xutiancheng.me/v1/upload/\"\n          ,\n          method: \"post\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 76\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          type: \"file\",\n          name: \"file\",\n          onChange: function onChange(e) {\n            return _this2.handleFile(e);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 82\n          },\n          __self: this\n        }), React.createElement(\"input\", {\n          type: \"submit\",\n          value: \"upload\",\n          onClick: function onClick(e) {\n            return _this2.sendRequest(e);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 84\n          },\n          __self: this\n        })), React.createElement(Alert, {\n          variant: \"danger\",\n          onClose: function onClose() {\n            return setShow(false);\n          },\n          dismissible: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 86\n          },\n          __self: this\n        }, React.createElement(Alert.Heading, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87\n          },\n          __self: this\n        }, \"photo uploaded\"), React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 88\n          },\n          __self: this\n        }, \"to check the photo, return to main page, then go to the photo management page.\")));\n      } else {\n        return React.createElement(React.Fragment, null, React.createElement(Errors, {\n          error: error,\n          setError: this.setError,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 96\n          },\n          __self: this\n        }), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 97\n          },\n          __self: this\n        }, \"Upload a new image\"), React.createElement(\"form\", {\n          target: \"_blank\",\n          encType: \"multipart/form-data\" // action=\"https://api.xutiancheng.me/v1/upload/\"\n          ,\n          method: \"post\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 98\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          type: \"file\",\n          name: \"file\",\n          onChange: function onChange(e) {\n            return _this2.handleFile(e);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 104\n          },\n          __self: this\n        }), React.createElement(\"input\", {\n          type: \"submit\",\n          value: \"upload\",\n          onClick: function onClick(e) {\n            return _this2.sendRequest(e);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 106\n          },\n          __self: this\n        })));\n      }\n    }\n  }]);\n\n  return UploadImage;\n}(Component);\n\nexport default UploadImage;","map":{"version":3,"sources":["/Users/danfengyang/go/src/INFO441/collaborative-photo-management/clients/final-clients/src/Components/Main/Components/UploadImage/UploadImage.js"],"names":["React","Component","api","Errors","Alert","UploadImage","props","sendRequest","e","preventDefault","file","state","fileName","name","data","FormData","append","fetch","base","handlers","upload","method","body","headers","Headers","localStorage","getItem","response","status","text","error","setError","JSON","stringify","then","resp","setShow","handleFile","setState","target","files","boo","show","firstName","lastName"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport api from '../../../../Constants/APIEndpoints/APIEndpoints';\nimport Errors from '../../../Errors/Errors';\nimport Alert from 'react-bootstrap/Alert';\n\nclass UploadImage extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            file: null,\n            error: '',\n            show:false\n        }\n    }\n\n    sendRequest = async (e) => {\n        e.preventDefault();\n        const { file } = this.state;\n        var fileName = file.name;\n        let data = new FormData()\n        data.append('file', file);\n        const response = await fetch(api.base + api.handlers.upload, {\n            method: \"POST\",\n            body: data,\n            headers: new Headers({\n                // 'Content-Type': 'application/json',\n                \"Authorization\": localStorage.getItem(\"Authorization\"),\n            })\n        });\n        if (response.status >= 300) {\n            const error = await response.text();\n            this.setError(error);\n            return;\n        } else if (response.status === 200) {\n            fetch(\"https://api.xutiancheng.me/v1/photos\", {\n                method: \"POST\",\n                body: JSON.stringify({\"url\": \"https://image-441.s3.amazonaws.com/\"+fileName}),\n                headers: new Headers({\n                    'Content-Type': 'application/json',\n                    \"Authorization\": localStorage.getItem(\"Authorization\"),\n                })\n            })\n            .then(resp =>{\n                if (resp.status == 201){\n                    this.setShow(true);\n                } else{\n                    const error = response.text();\n                    this.setError(error);\n            return;\n                }\n            });\n        }\n    }\n\n    handleFile = (e) => {\n        this.setState({\n            file: e.target.files[0]\n        });\n    }\n\n    setError = (error) => {\n        this.setState({ error })\n    }\n\n    setShow = (boo) => {\n        this.setState({ show })\n    }\n\n    \n    render() {\n        const { firstName, lastName, error } = this.state;\n        if (show) {\n        return <>\n            <Errors error={error} setError={this.setError} />\n            <div>Upload a new image</div>\n            <form\n                target=\"_blank\"\n                encType=\"multipart/form-data\"\n                // action=\"https://api.xutiancheng.me/v1/upload/\"\n                method=\"post\"\n                >\n                <input type=\"file\" name=\"file\" onChange={(e) => this.handleFile(e)}/>\n                {/* <input type=\"submit\" value=\"upload\"/>    */}\n                <input type=\"submit\" value=\"upload\" onClick={(e) => this.sendRequest(e)} />   \n            </form>\n            <Alert variant=\"danger\" onClose={() => setShow(false)} dismissible>\n            <Alert.Heading>photo uploaded</Alert.Heading>\n            <p>\n                to check the photo, return to main page, then go to\n                the photo management page.\n            </p>\n          </Alert>\n        </>\n        } else {\n            return <>\n            <Errors error={error} setError={this.setError} />\n            <div>Upload a new image</div>\n            <form\n                target=\"_blank\"\n                encType=\"multipart/form-data\"\n                // action=\"https://api.xutiancheng.me/v1/upload/\"\n                method=\"post\"\n                >\n                <input type=\"file\" name=\"file\" onChange={(e) => this.handleFile(e)}/>\n                {/* <input type=\"submit\" value=\"upload\"/>    */}\n                <input type=\"submit\" value=\"upload\" onClick={(e) => this.sendRequest(e)} />   \n            </form>\n        </>\n        }\n    }\n\n}\n\nexport default UploadImage;"]},"metadata":{},"sourceType":"module"}